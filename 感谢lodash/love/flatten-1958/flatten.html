<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>Flatten</title>
</head>

<body>
</body>
</html>
<script>
    function flattenDeep(arr) {
        let len = arr === null ? 0 : arr.length;
        return len ? baseFlatten(arr, INFINITY) : [];
    }

    const INFINITY = 1 / 0; // 无穷
    const isArray = Array.isArray;

    function baseFlatten(arr, depth, isStrict, result = []) {
        let index = -1,
            len = arr.length;

        while (++index < len) {
            let val = arr[index];

            if (depth > 0 && isArray(val)) {
                if (depth > 1) {
                    // 如果是多维数组超过二维数组的情况
                    // 继续递归下去
                    baseFlatten(val, depth - 1, isStrict, result);
                } else {
                    // 如果只是展平二维数组的话就走这里
                    arrayPush(result, val);
                }
            } else if (!isStrict) {
                // 如果是个普通的值不是数组的话，直接push到result里
                result.push(val);
            }
        }

        return result;
    }

    function arrayPush(arr, multiArr) {
        let index = -1,
            len = multiArr.length,
            offset = arr.length;

        while (++index < len) {
            arr[offset + index] = multiArr[index];
        }

        return arr;
    }

    console.log(flattenDeep([3, 1, [5, [4, 9], 13], 22]))
</script>